<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Working with custom interpreters · Herb.jl</title><meta name="title" content="Working with custom interpreters · Herb.jl"/><meta property="og:title" content="Working with custom interpreters · Herb.jl"/><meta property="twitter:title" content="Working with custom interpreters · Herb.jl"/><meta name="description" content="Documentation for Herb.jl."/><meta property="og:description" content="Documentation for Herb.jl."/><meta property="twitter:description" content="Documentation for Herb.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="Herb.jl logo"/></a><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><span class="tocitem">Basics</span><ul><li><a class="tocitem" href="../../">Herb.jl</a></li><li><a class="tocitem" href="../../install/">Installation Guide</a></li><li><a class="tocitem" href="../basic_getting_started/">Getting Started</a></li><li><a class="tocitem" href="../../concepts/">Herb Architecture and Core Concepts</a></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../getting_started_with_herb/">A more verbose getting started with Herb.jl</a></li><li><a class="tocitem" href="../defining_grammars/">Defining Grammars in Herb.jl</a></li><li><a class="tocitem" href="../advanced_search/">Advanced Search Procedures</a></li><li><a class="tocitem" href="../TopDown/">Top Down Iterator</a></li><li><a class="tocitem" href="../getting_started_with_constraints/">Getting started with Constraints</a></li><li class="is-active"><a class="tocitem" href>Working with custom interpreters</a></li><li><a class="tocitem" href="../abstract_syntax_trees/">Abstract Syntax Trees</a></li></ul></li><li><span class="tocitem">Sub-Modules</span><ul><li><a class="tocitem" href="../../HerbCore/">HerbCore.jl</a></li><li><a class="tocitem" href="../../HerbGrammar/">HerbGrammar.jl</a></li><li><a class="tocitem" href="../../HerbSpecification/">HerbSpecification.jl</a></li><li><a class="tocitem" href="../../HerbInterpret/">HerbInterpret.jl</a></li><li><a class="tocitem" href="../../HerbConstraints/">HerbConstraints.jl</a></li><li><a class="tocitem" href="../../HerbSearch/">HerbSearch.jl</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Working with custom interpreters</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Working with custom interpreters</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/Herb-AI/Herb.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/Herb-AI/Herb.jl/blob/main/docs/src/tutorials/working_with_interpreters.jl" title="View source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><style>
    #documenter-page table {
        display: table !important;
        margin: 2rem auto !important;
        border-top: 2pt solid rgba(0,0,0,0.2);
        border-bottom: 2pt solid rgba(0,0,0,0.2);
    }

    #documenter-page pre, #documenter-page div {
        margin-top: 1.4rem !important;
        margin-bottom: 1.4rem !important;
    }

    .code-output {
        padding: 0.7rem 0.5rem !important;
    }

    .admonition-body {
        padding: 0em 1.25em !important;
    }
</style>

<!-- PlutoStaticHTML.Begin -->
<!--
    # This information is used for caching.
    [PlutoStaticHTML.State]
    input_sha = "88ed49dd3eb86fb25d8795d6eaa71634180cbc1261f2cbb3e24a5f6225711b28"
    julia_version = "1.11.7"
-->
<pre class='language-julia'><code class='language-julia'>begin
    import Pkg
    Pkg.activate(Base.current_project())
    Pkg.instantiate()
end</code></pre>


<pre class='language-julia'><code class='language-julia'>using Herb</code></pre>



<div class="markdown"><h1 id="Using-the-Julia-interpreter">Using the Julia interpreter</h1><p>To know how good a candidate program is, program synthesisers execute them. The easiest way to execute a program is to rely on Julia itself. To leverage the Julia interpreter, you only have to ensure that your programs are valid Julia expressions. </p><p>For example, assume the following grammar.</p></div>

<pre class='language-julia'><code class='language-julia'>g = @csgrammar begin
    Number = |(1:2)
    Number = x
    Number = Number + Number
    Number = Number * Number
end</code></pre>
<pre class="code-output documenter-example-output" id="var-g">1: Number = 1
2: Number = 2
3: Number = x
4: Number = Number + Number
5: Number = Number * Number
</pre>


<div class="markdown"><p>Let's construct a program <code>x+3</code>, which would correspond to the following <code>RuleNode</code> representation</p></div>

<pre class='language-julia'><code class='language-julia'>myprog = @rulenode 4{3,1}</code></pre>
<pre class="code-output documenter-example-output" id="var-myprog">4{3,1}</pre>


<div class="markdown"><p>To run this program, we have to convert it into a Julia expression, which we can do in the following way:</p></div>

<pre class='language-julia'><code class='language-julia'>myprog_julia = rulenode2expr(myprog, g)</code></pre>
<pre class="code-output documenter-example-output" id="var-myprog_julia">:(x + 1)</pre>


<div class="markdown"><p>Now we have a valid Julia expression, but we are still missing one key ingredient: we have to inform the interpreter about the special symbols. In our case, these are <code>:x</code> and <code>:+</code>. To do so, we need to create a symbol table, which is nothing more than a dictionary mapping symbols to their values:</p></div>

<pre class='language-julia'><code class='language-julia'>symboltable = Dict{Symbol,Any}(:x =&gt; 2, :+ =&gt; +)</code></pre>
<pre class="code-output documenter-example-output" id="var-symboltable">Dict{Symbol, Any} with 2 entries:
  :+ =&gt; +
  :x =&gt; 2</pre>


<div class="markdown"><p>Now we can execute our program through the default interpreter available in <code>HerbInterpret</code>:</p></div>

<pre class='language-julia'><code class='language-julia'>interpret(symboltable, myprog_julia)</code></pre>
<pre class="code-output documenter-example-output" id="var-hash103373">3</pre>


<div class="markdown"><p>And that's it!</p></div>


<div class="markdown"><h1 id="Defining-a-custom-interpreter">Defining a custom interpreter</h1><p>A disadvantage of the default Julia interpreter is that it needs to traverse abstract syntax tree twice – once to convert it into a Julia expression, and the second time to execute that expression. Program execution is regularly the most consuming part of the entire pipeline and, by eliminating one of these steps, we can cut the runtime in half.</p><p>We can define an interpreter that works directly over <code>RuleNode</code>s.  Consider the scenario in which we want to write programs for robot navigation: imagine a 2D world in which the robot can move around and pick up a ball. The programs we could write direct the robot to go up, down, left, and right. For convenience, the programming language also offers conditionals and loops:</p></div>

<pre class='language-julia'><code class='language-julia'>grammar_robots = @csgrammar begin
    Start = Sequence                   #1

    Sequence = Operation                #2
    Sequence = (Operation; Sequence)    #3
    Operation = Transformation          #4
    Operation = ControlStatement        #5

    Transformation = moveRight() | moveDown() | moveLeft() | moveUp() | drop() | grab()     #6
    ControlStatement = IF(Condition, Sequence, Sequence)        #12
    ControlStatement = WHILE(Condition, Sequence)               #13

    Condition = atTop() | atBottom() | atLeft() | atRight() | notAtTop() | notAtBottom() | notAtLeft() | notAtRight()      #14
end</code></pre>
<pre class="code-output documenter-example-output" id="var-grammar_robots">1: Start = Sequence
2: Sequence = Operation
3: Sequence = begin
    Operation
    Sequence
end
4: Operation = Transformation
5: Operation = ControlStatement
6: Transformation = moveRight()
7: Transformation = moveDown()
8: Transformation = moveLeft()
9: Transformation = moveUp()
10: Transformation = drop()
11: Transformation = grab()
12: ControlStatement = IF(Condition, Sequence, Sequence)
13: ControlStatement = WHILE(Condition, Sequence)
14: Condition = atTop()
15: Condition = atBottom()
16: Condition = atLeft()
17: Condition = atRight()
18: Condition = notAtTop()
19: Condition = notAtBottom()
20: Condition = notAtLeft()
21: Condition = notAtRight()
</pre>


<div class="markdown"><p>This grammar specifies a simple sequential program with instructions for the robot. A couple of example programs:</p><ul><li><p><code>moveRight(); moveLeft(); drop()</code></p></li><li><p>WHILE(notAtTop(), moveUp())</p></li></ul><p>The idea behind this programming language is that the program specifies a set of transformations over a state of the robot world. Thus, a program can only be executed over a particular state. In this case, the state represents the size of the 2D world, the current position of a robot, the current position of a ball, and whether the robot is currently holding a ball. The execution of a particular instruction acts as a state transformation: each instruction takes a state as an input, transforms it, and passes it to the subsequent instruction. For example, execution of the program <code>moveRight(); moveLeft(); drop()</code> would proceed as:</p><ol><li><p>take an input state, </p></li><li><p>pass it to the <code>moveRight()</code> instruction,</p></li><li><p>pass the output of <code>moveRight()</code> to <code>moveLeft()</code> instructions,</p></li><li><p>pass the output of <code>moveLeft()</code> to <code>drop()</code>,</p></li><li><p>return the output of <code>drop()</code>.</p></li></ol><p>The following is only one possible way to implement a custom interpreter, but it demonstrates a general template that can always be followed.</p><p>We want to implement the following function, which would take in a program in the form of a <code>RuleNode</code>, a grammar, and a starting state, and return the state obtained after executing the program:</p><pre><code>    interpret(prog::AbstractRuleNode, grammar::ContextSensitiveGrammar, state::RobotState)::RobotState</code></pre><p>As <code>RuleNode</code>s only store indices of derivation rules from the grammar, not the functions themselves, we will first pull the function call associated with every derivation rule. In Julia, this is indicated by the top-level symbol of the rules. For example, the top-level symbol for the derivation rule 6 is <code>:moveRight</code>; for rule 12, that is <code>:IF</code>.</p></div>


<div class="markdown"><p>The remaining functions follow a similar idea. (You can see the full implementation of this interpreter <a href="https://github.com/Herb-AI/HerbBenchmarks.jl/blob/master/src/data/Robots_2020/robots_primitives.jl">here</a>).</p></div>

<!-- PlutoStaticHTML.End --><script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';
mermaid.initialize({
    startOnLoad: true,
    theme: "neutral"
});
</script></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../getting_started_with_constraints/">« Getting started with Constraints</a><a class="docs-footer-nextpage" href="../abstract_syntax_trees/">Abstract Syntax Trees »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Wednesday 1 October 2025 10:13">Wednesday 1 October 2025</span>. Using Julia version 1.11.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
