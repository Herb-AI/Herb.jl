<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Working with custom interpreters · Herb.jl</title><meta name="title" content="Working with custom interpreters · Herb.jl"/><meta property="og:title" content="Working with custom interpreters · Herb.jl"/><meta property="twitter:title" content="Working with custom interpreters · Herb.jl"/><meta name="description" content="Documentation for Herb.jl."/><meta property="og:description" content="Documentation for Herb.jl."/><meta property="twitter:description" content="Documentation for Herb.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="Herb.jl logo"/></a><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><span class="tocitem">Basics</span><ul><li><a class="tocitem" href="../../">Herb.jl</a></li><li><a class="tocitem" href="../../install/">Installation Guide</a></li><li><a class="tocitem" href="../../get_started/">Getting Started</a></li><li><a class="tocitem" href="../../concepts/">Architecture and core concepts</a></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../getting_started_with_herb/">A more verbose getting started with Herb.jl</a></li><li><a class="tocitem" href="../defining_grammars/">Defining Grammars in Herb.jl</a></li><li><a class="tocitem" href="../advanced_search/">Advanced Search Procedures</a></li><li><a class="tocitem" href="../TopDown/">Top Down Iterator</a></li><li><a class="tocitem" href="../getting_started_with_constraints/">Getting started with Constraints</a></li><li class="is-active"><a class="tocitem" href>Working with custom interpreters</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#Defining-a-custom-interpreter"><span>Defining a custom interpreter</span></a></li></ul></li></ul></li><li><span class="tocitem">Sub-Modules</span><ul><li><a class="tocitem" href="../../HerbCore/">HerbCore.jl</a></li><li><a class="tocitem" href="../../HerbGrammar/">HerbGrammar.jl</a></li><li><a class="tocitem" href="../../HerbSpecification/">HerbSpecification.jl</a></li><li><a class="tocitem" href="../../HerbInterpret/">HerbInterpret.jl</a></li><li><a class="tocitem" href="../../HerbConstraints/">HerbConstraints.jl</a></li><li><a class="tocitem" href="../../HerbSearch/">HerbSearch.jl</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Working with custom interpreters</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Working with custom interpreters</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/Herb-AI/Herb.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/Herb-AI/Herb.jl/blob/master/docs/src/tutorials/working_with_interpreters.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Using-the-Julia-interpreter"><a class="docs-heading-anchor" href="#Using-the-Julia-interpreter">Using the Julia interpreter</a><a id="Using-the-Julia-interpreter-1"></a><a class="docs-heading-anchor-permalink" href="#Using-the-Julia-interpreter" title="Permalink"></a></h1><p>To know how good a candidate program is, program synthesisers execute them. The easiest way to execute a program is to rely on Julia itself. To leverage the Julia interpreter, you only have to ensure that your programs are valid Julia expressions. </p><p>First, let&#39;s import the necessary packages</p><pre><code class="language-julia hljs">using HerbGrammar, HerbInterpret</code></pre><p>Now, assume the following grammar.</p><pre><code class="language-julia hljs">g = @cfgrammar begin
    Number = |(1:2)
    Number = x
    Number = Number + Number
    Number = Number * Number
 end</code></pre><pre><code class="nohighlight hljs">1: Number = 1
2: Number = 2
3: Number = x
4: Number = Number + Number
5: Number = Number * Number</code></pre><p>Let&#39;s construct a program <code>x+3</code>, which would correspond to the following <code>RuleNode</code> representation</p><pre><code class="language-julia hljs">myprog = RuleNode(4,[RuleNode(3),RuleNode(1)])</code></pre><pre><code class="nohighlight hljs">4{3,1}</code></pre><p>To run this program, we have to convert it into a Julia expression, which we can do in the following way:</p><pre><code class="language-julia hljs">myprog_julia = rulenode2expr(myprog, g)</code></pre><pre><code class="nohighlight hljs">:(x + 1)</code></pre><p>Now we have a valid Julia expression, but we are still missing one key ingredient: we have to inform the interpreter about the special symbols. In our case, these are <code>:x</code> and <code>:+</code>. To do so, we need to create a symbol table, which is nothing more than a dictionary mapping symbols to their values:</p><pre><code class="language-julia hljs">symboltable = Dict{Symbol,Any}(:x =&gt; 2, :+ =&gt; +)</code></pre><pre><code class="nohighlight hljs">Dict{Symbol, Any} with 2 entries:
  :+ =&gt; +
  :x =&gt; 2</code></pre><p>Now we can execute our program through the defaul interpreter available in <code>HerbInterpret</code>:</p><pre><code class="language-julia hljs">interpret(symboltable, myprog_julia)</code></pre><pre><code class="nohighlight hljs">3</code></pre><p>And that&#39;s it!</p><h1 id="Defining-a-custom-interpreter"><a class="docs-heading-anchor" href="#Defining-a-custom-interpreter">Defining a custom interpreter</a><a id="Defining-a-custom-interpreter-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-a-custom-interpreter" title="Permalink"></a></h1><p>A disadvantage of the default Julia interpreter is that it needs to traverse abstract syntax tree twice – once to convert it into a Julia expression, and the second time to execute that expression. Program execution is regularly the most consuming part of the entire pipeline and, by eliminating one of these steps, we can cut the runtime in half.</p><p>We can define an interpreter that works directly over <code>RuleNode</code>s.  Consider the scenario in which we want to write programs for robot navigation: imagine a 2D world in which the robot can move around and pick up a ball. The programs we could write direct the robot to go up, down, left, and right. For convenience, the programming language also offers conditionals and loops:</p><pre><code class="language-julia hljs">grammar_robots = @csgrammar begin
    Start = Sequence                   #1

    Sequence = Operation                #2
    Sequence = (Operation; Sequence)    #3
    Operation = Transformation          #4
    Operation = ControlStatement        #5

    Transformation = moveRight() | moveDown() | moveLeft() | moveUp() | drop() | grab()     #6
    ControlStatement = IF(Condition, Sequence, Sequence)        #12
    ControlStatement = WHILE(Condition, Sequence)               #13

    Condition = atTop() | atBottom() | atLeft() | atRight() | notAtTop() | notAtBottom() | notAtLeft() | notAtRight()      #14
end</code></pre><p>This grammar specifies a simple sequential program with instructions for the robot. A couple of example programs:</p><ul><li><code>moveRight(); moveLeft(); drop()</code></li><li>WHILE(notAtTop(), moveUp())</li></ul><p>The idea behind this programming language is that the program specifies a set of transformations over a state of the robot world. Thus, a program can only be executed over a particular state. In this case, the state represents the size of the 2D world, the current position of a robot, the current position of a ball, and whether the robot is currently holding a ball. The execution of a particular instruction acts as a state transformation: each instruction takes a state as an input, transforms it, and passes it to the subsequent instruction. For example, execution of the program <code>moveRight(); moveLeft(); drop()</code> would proceed as:</p><ol><li>take an input state, </li><li>pass it to the <code>moveRight()</code> instruction,</li><li>pass the output of <code>moveRight()</code> to <code>moveLeft()</code> instructions,</li><li>pass the output of <code>moveLeft()</code> to <code>drop()</code>,</li><li>return the output of <code>drop()</code>.</li></ol><p>The following is only one possible way to implement a custom interpreter, but it demonstrates a general template that can always be followed.</p><p>We want to implement the following function, which would take in a program in the form of a <code>RuleNode</code>, a grammar, and a starting state, and return the state obtained after executing the program:</p><pre><code class="nohighlight hljs">    interpret(prog::AbstractRuleNode, grammar::ContextSensitiveGrammar, state::RobotState)::RobotState</code></pre><p>As <code>RuleNode</code>s only store indices of derivation rules from the grammar, not the functions themselves, we will first pull the function call associated with every derivation rule. In Julia, this is indicated by the top-level symbol of the rules. For example, the top-level symbol for the derivation rule 6 is <code>:moveRight</code>; for rule 12, that is <code>:IF</code>.</p><p>The remaining functions follow a similar idea. (You can see the full implementation of this interpreter <a href="https://github.com/Herb-AI/HerbBenchmarks.jl/blob/new-robots/src/data/Robots_2020/robots_primitives.jl">here</a>).</p><pre><code class="language-julia hljs">PLUTO_PROJECT_TOML_CONTENTS = &quot;&quot;&quot;
[deps]
HerbGrammar = &quot;4ef9e186-2fe5-4b24-8de7-9f7291f24af7&quot;
HerbInterpret = &quot;5bbddadd-02c5-4713-84b8-97364418cca7&quot;

[compat]
HerbGrammar = &quot;~0.3.0&quot;
HerbInterpret = &quot;~0.1.3&quot;
&quot;&quot;&quot;</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../getting_started_with_constraints/">« Getting started with Constraints</a><a class="docs-footer-nextpage" href="../../HerbCore/">HerbCore.jl »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.5.0 on <span class="colophon-date" title="Tuesday 9 July 2024 11:18">Tuesday 9 July 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
